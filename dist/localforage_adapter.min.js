(function(){"use strict";DS.LSAdapter=DS.Adapter.extend(Ember.Evented,{find:function(e,r,n,t){var i,a,o;return i=this,a=!0,o=this._namespaceForType(r),t&&"undefined"!=typeof t.allowRecursive&&(a=t.allowRecursive),new Ember.RSVP.Promise(function(e,t){return o.then(function(o){var u;return u=Ember.A(o.records[n]),a&&!Ember.isEmpty(u)?i.loadRelationships(r,u).then(function(r){return Ember.run(null,e,r)}):Ember.isEmpty(u)?Ember.run(null,t):Ember.run(null,e,u)})})},findMany:function(e,r,n){var t,i;return t=this,i=this._namespaceForType(r),new Ember.RSVP.Promise(function(e){return i.then(function(r){var t,i;for(i=[],t=0;t<n.length;)i.push(Ember.copy(r.records[n[t]])),t++;return Ember.run(null,e,i)}).then(function(e){return e.get("length")?t.loadRelationshipsForMany(r,e):e})})},findQuery:function(e,r,n){var t,i;return i=this._namespaceForType(r),t=this,new Ember.RSVP.Promise(function(e){return i.then(function(i){var a;return a=t.query(i.records,n),a.get("length")&&(a=t.loadRelationshipsForMany(r,a)),Ember.run(null,e,a)})})},query:function(e,r){var n,t,i,a,o,u;o=[],n=void 0,a=void 0,t=void 0,u=void 0,i=void 0;for(n in e){a=e[n];for(t in r)u=r[t],i=!1,i="[object RegExp]"===Object.prototype.toString.call(u)?u.test(a[t]):a[t]===u;i&&o.push(a)}return o},findAll:function(e,r){var n,t;return n=this._namespaceForType(r),t=[],new Ember.RSVP.Promise(function(e){return n.then(function(r){var n;for(n in r.records)t.push(Ember.copy(r.records[n]));return Ember.run(null,e,t)})})},createRecord:function(e,r,n){var t,i;return i=this._namespaceForType(r),t=this,new Ember.RSVP.Promise(function(e){return i.then(function(i){var a;return a=n.serialize({includeId:!0}),i.records[a.id]=a,t.persistData(r,i).then(function(){return Ember.run(null,e)})})})},updateRecord:function(e,r,n){var t,i,a;return a=this._namespaceForType(r),i=n.get("id"),t=this,new Ember.RSVP.Promise(function(e){return a.then(function(a){return a.records[i]=n.serialize({includeId:!0}),t.persistData(r,a).then(function(){return Ember.run(null,e)})})})},deleteRecord:function(e,r,n){var t,i,a;return a=this._namespaceForType(r),i=n.get("id"),t=this,new Ember.RSVP.Promise(function(e){return a.then(function(n){return delete n.records[i],t.persistData(r,n).then(function(){return Ember.run(null,e)})})})},generateIdForRecord:function(){return Math.random().toString(32).slice(2).substr(0,5)},adapterNamespace:function(){return this.namespace||"DS.LSAdapter"},loadData:function(){var e;return e=this._adapter().getItem(this.adapterNamespace()),e?e:{}},persistData:function(e,r){var n,t,i;return i=this.modelNamespace(e),t=this.loadData(),n=this,t.then(function(e){return e[i]=r,n._adapter().setItem(n.adapterNamespace(),e)})},_namespaceForType:function(e){var r,n;return r=this.modelNamespace(e),n=this._adapter().getItem(this.adapterNamespace()),n.then(function(e){return e?e[r]||{records:{}}:{records:{}}})},_adapter:function(){return localforage},modelNamespace:function(e){return e.url||e.toString()},loadRelationships:function(e,r){var n;return n=this,new Ember.RSVP.Promise(function(t){var i,a,o,u,s;return u={},s=e.typeKey,i=void 0,o=void 0,a=[],i=Ember.get(e,"relationshipNames"),o=i.belongsTo,o=o.concat(i.hasMany),o.forEach(function(t){var i,o,u,s,c,d,l;return c=e.typeForRelationship(t),s=r[t],d=n.relationshipProperties(e,t),l=d.kind,u=void 0,i=void 0,o={allowRecursive:!1},s?("belongsTo"===l||"hasOne"===l?u=n.find(null,c,s,o):"hasMany"===l&&(u=n.findMany(null,c,s,o)),i=new Ember.RSVP.Promise(function(e){return u.then(function(i){var a;return a=n.addEmbeddedPayload(r,t,i),e(a)})}),a.push(i)):void 0}),Ember.RSVP.all(a).then(function(){return t(r)})})},addEmbeddedPayload:function(e,r,n){var t,i,a;return a=n&&n.id,t=n.length&&n.everyBy("id"),i=a||t,i&&(e._embedded||(e._embedded={}),e._embedded[r]=n,e[r]=n.length?n.mapBy("id"):n.id),this.isArray(e[r])&&(e[r]=e[r].filter(function(e){return e})),e},isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)},loadRelationshipsForMany:function(e,r){var n;return n=this,new Ember.RSVP.Promise(function(t){var i,a,o,u,s;s=[],u=[],o=[];for(i in r)r.hasOwnProperty(i)&&u.push(r[i]);return(a=function(r){var i;return u=u.slice(1),i=n.loadRelationships(e,r),i.then(function(e){return s.push(e),u[0]?a(u[0]):t(s)})})(u[0])})},relationshipProperties:function(e,r){var n;return n=Ember.get(e,"relationshipsByName"),r?n.get(r):n}})}).call(this),function(){"use strict";DS.LSSerializer=DS.JSONSerializer.extend({serializeHasMany:function(e,r,n){var t,i;return t=n.key,i=DS.RelationshipChange.determineRelationshipType(e.constructor,n),"manyToNone"===i||"manyToMany"===i||"manyToOne"===i?r[t]=e.get(t).mapBy("id"):void 0},extractSingle:function(e,r,n){var t,i,a;if(n&&n._embedded){for(i in n._embedded)a=Ember.String.singularize(i),t=n._embedded[i],t&&(Ember.isArray(t)?e.pushMany(a,t):e.push(a,t));delete n._embedded}return this.normalize(r,n)},extractArray:function(e,r,n){var t;return t=this,n.map(function(n){var i;return i=t.extractSingle(e,r,n),t.normalize(r,n)})}})}.call(this);